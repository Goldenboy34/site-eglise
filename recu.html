<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reçu</title>
<link rel="stylesheet" href="css/style.css">
<style>
body{font-family:'Poppins',sans-serif;background:linear-gradient(135deg,#0d47a1,#000);display:flex;justify-content:center;align-items:center;min-height:100vh;margin:0;color:#fff;}
.recu-container{background:white;color:#000;border-radius:20px;padding:30px;width:400px;box-shadow:0 8px 20px rgba(0,0,0,0.3);text-align:center;}
.recu-container h2{color:#0d47a1;margin-bottom:15px;}
#recapitulatif p{margin:6px 0;word-wrap:break-word;white-space:pre-wrap;}
.btn-telecharger{margin-top:20px;padding:10px 20px;border:none;border-radius:8px;background:#0d47a1;color:white;cursor:pointer;}
.btn-telecharger:hover{background:#1565c0;}
</style>
</head>
<body>
<div class="recu-container">
<h2>Reçu de la Demande de Messe</h2>
<div id="recapitulatif"></div>
<button id="telechargerPDF" class="btn-telecharger">Télécharger le reçu</button>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
const data = JSON.parse(localStorage.getItem("demandeMesse")) || {};
const recap = document.getElementById("recapitulatif");
recap.innerHTML = `
<p><strong>Nom :</strong> ${data.username || ""}</p>
<p><strong>Date :</strong> ${data.date || ""}</p>
<p><strong>Type :</strong> ${data.type || ""}</p>
<p><strong>Heure :</strong> ${data.heure || ""}</p>
<p><strong>Contact :</strong> ${data.contact || ""}</p>
<p><strong>Intention :</strong><br>${data.intention || ""}</p>
${data.paymentImage ? `<p><strong>Paiement :</strong><br><img src="${data.paymentImage}" width="200"></p>` : ""}
`;
document.getElementById("telechargerPDF").addEventListener("click", ()=>{
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    let y = 20;
    doc.setFontSize(16); doc.setTextColor(13,71,161); doc.text("Reçu de la Demande de Messe",20,y); y+=10;
    doc.setFontSize(12); doc.setTextColor(0,0,0);
    ["username","date","type","heure","contact","intention"].forEach(k=>{
        if(k==="intention"){
            let splitText = doc.splitTextToSize("Intention : "+(data[k]||""),170);
            doc.text(splitText,20,y); y+=splitText.length*10;
        }else{
            doc.text(`${k.charAt(0).toUpperCase()+k.slice(1)} : ${data[k]||""}`,20,y); y+=10;
        }
    });
    doc.save("Reçu_Demande_Messe.pdf");
    // Optionnel : envoyer email via Formspree
});
</script>
</body>
</html>
