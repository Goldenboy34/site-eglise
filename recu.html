<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reçu Intention de Messe</title>
<link rel="stylesheet" href="css/style.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>

<header>
  <h1>Reçu de votre intention de messe</h1>
</header>

<main class="section-container">
  <img src="images/logo.jpg" alt="Logo Paroisse" style="display:block;margin:0 auto;width:120px;">
  <div id="recapitulatif" class="activite"></div>
  <button id="download-btn">Télécharger le reçu</button>
</main>

<script>
const tarifs = {
  "Messe de semaine": 1500,
  "Messe du dimanche": 3500,
  "Tridum": 0,
  "Neuvaine": 0
};

const dataStr = sessionStorage.getItem('intentionMesseData');
const recapDiv = document.getElementById('recapitulatif');

if(!dataStr){
  recapDiv.innerHTML = "<p style='color:red;'>Aucune donnée trouvée. Veuillez remplir le formulaire.</p>";
  document.getElementById('download-btn').disabled = true;
} else {
  const data = JSON.parse(dataStr);
  const montant = tarifs[data.type_messe];
  const montantAffiche = montant>0 ? montant+" FCFA" : "Montant non défini";

  recapDiv.innerHTML = `
    <p><strong>Nom :</strong> ${data.nom}</p>
    <p><strong>Date :</strong> ${data.date}</p>
    <p><strong>Type de messe :</strong> ${data.type_messe}</p>
    <p><strong>Heure :</strong> ${data.heure}</p>
    <p><strong>Intention :</strong> ${data.intention}</p>
    <p><strong>Contact :</strong> ${data.contact}</p>
    <p><strong>Montant :</strong> ${montantAffiche}</p>
  `;

  document.getElementById('download-btn').addEventListener('click', ()=>{
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.setFontSize(16);
    doc.text("Reçu Intention de Messe", 105, 20, {align:'center'});
    let y = 40;
    Object.keys(data).forEach(k=>{
      doc.text(`${k.charAt(0).toUpperCase()+k.slice(1)} : ${data[k]}`, 15, y);
      y+=10;
    });
    doc.text(`Montant : ${montantAffiche}`, 15, y);
    doc.save("recu_intention_messe.pdf");
  });
}
</script>

</body>
</html>
